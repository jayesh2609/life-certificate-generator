<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Life Certificate Generator</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background-color: #f8f9fa; }
        .container { max-width: 600px; }
        .card { border: none; box-shadow: 0 4px 8px rgba(0,0,0,0.1); }
        .spinner-border { width: 1rem; height: 1rem; }
    </style>
</head>
<body>
    <div class="container mt-5">
        <div class="card">
            <div class="card-body p-5">
                <h1 class="card-title text-center mb-4">ðŸ“œ Life Certificate Generator</h1>
                <p class="text-muted text-center">Upload a screenshot from the "Beneficiary Satyapan App" to automatically generate a professional Life Certificate PDF.</p>
                
                <form id="upload-form" class="mt-4">
                    <div class="mb-3">
                        <label for="file-upload" class="form-label">Select Screenshot (JPG, PNG)</label>
                        <input class="form-control" type="file" id="file-upload" name="file" accept="image/png, image/jpeg" required>
                    </div>
                    <div class="d-grid">
                        <button type="submit" class="btn btn-primary btn-lg" id="submit-btn">
                            <span id="btn-text">Generate Certificate</span>
                            <span class="spinner-border ms-2 d-none" id="loader" role="status" aria-hidden="true"></span>
                        </button>
                    </div>
                </form>

                <div id="alert-container" class="mt-4"></div>
            </div>
        </div>
        <footer class="text-center text-muted mt-4">
            <p>&copy; 2025 AI Certificate Tool</p>
        </footer>
    </div>

    <script>
        const uploadForm = document.getElementById('upload-form');
        const submitBtn = document.getElementById('submit-btn');
        const btnText = document.getElementById('btn-text');
        const loader = document.getElementById('loader');
        const alertContainer = document.getElementById('alert-container');

        uploadForm.addEventListener('submit', async (event) => {
            event.preventDefault();
            
            const fileInput = document.getElementById('file-upload');
            if (fileInput.files.length === 0) {
                showAlert('Please select a file first.', 'warning');
                return;
            }

            btnText.textContent = 'Processing...';
            loader.classList.remove('d-none');
            submitBtn.disabled = true;
            alertContainer.innerHTML = '';

            const formData = new FormData();
            formData.append('file', fileInput.files[0]);

            try {
                const response = await fetch('/upload', {
                    method: 'POST',
                    body: formData,
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.error || 'An unknown error occurred.');
                }

                const result = await response.json();
                window.location.href = `/download/${result.pdf_filename}`;
                showAlert('PDF generated successfully! Your download will start shortly.', 'success');

            } catch (error) {
                showAlert(`Error: ${error.message}`, 'danger');
            } finally {
                btnText.textContent = 'Generate Certificate';
                loader.classList.add('d-none');
                submitBtn.disabled = false;
                uploadForm.reset();
            }
        });

        function showAlert(message, type) {
            const wrapper = document.createElement('div');
            wrapper.innerHTML = `<div class="alert alert-${type} alert-dismissible" role="alert"><div>${message}</div><button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button></div>`;
            alertContainer.append(wrapper);
        }
    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>